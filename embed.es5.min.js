(function (w, d) {
    var DEFAULTS = { title: "EUR â†’ PLN (NBP)", theme: "light", decimals: "4", refreshMs: "10000", showTimestamp: "true", initialHeight: 130, maxHeight: 1000 };
    function detectBase() { var s = d.currentScript || function () { var a = d.getElementsByTagName("script"); return a[a.length - 1]; }(); if (!s || !s.src) return ""; return s.src.replace(/\/[^\/?#]+(\?.*)?$/, "/"); }
    var BASE = detectBase();
    var WIDGET_URL = BASE + "eurpln-widget.html";
    function attr(el, n, f) { var v = el.getAttribute(n); return v === null || v === "" ? f : v; }
    function enc(v) { return encodeURIComponent(String(v)); }
    function id() { return "eurpln_" + Math.floor(Math.random() * 1e9); }
    function src(el, i) { var s = WIDGET_URL + "?instanceId=" + enc(i) + "&title=" + enc(attr(el, "data-title", DEFAULTS.title)) + "&theme=" + enc(attr(el, "data-theme", DEFAULTS.theme)) + "&decimals=" + enc(attr(el, "data-decimals", DEFAULTS.decimals)) + "&refreshMs=" + enc(attr(el, "data-refresh-ms", DEFAULTS.refreshMs)) + "&showTimestamp=" + enc(attr(el, "data-show-timestamp", DEFAULTS.showTimestamp)); return s; }
    function mount(el) { var i = id(); el.__id = i; var f = d.createElement("iframe"); f.src = src(el, i); f.title = "EUR/PLN widget"; f.style.width = "100%"; f.style.border = "0"; f.style.display = "block"; f.style.height = DEFAULTS.initialHeight + "px"; f.setAttribute("sandbox", "allow-scripts allow-same-origin"); while (el.firstChild) el.removeChild(el.firstChild); el.appendChild(f); el.__f = f; }
    function boot() { var n = d.getElementsByClassName("eurpln-embed"); for (var i = 0; i < n.length; i++)mount(n[i]); }
    function onmsg(e) { if (!e || !e.data || e.data.type !== "EURPLN_WIDGET_HEIGHT") return; var h = parseInt(e.data.height, 10); if (!isFinite(h) || h <= 0 || h > DEFAULTS.maxHeight) return; var n = d.getElementsByClassName("eurpln-embed"); for (var i = 0; i < n.length; i++) { var el = n[i]; if (el.__id === e.data.instanceId && el.__f) { el.__f.style.height = h + "px"; break; } } }
    w.addEventListener("message", onmsg, false);
    if (d.readyState === "loading") d.addEventListener("DOMContentLoaded", boot); else boot();
})(window, document);
