(function (w, d) {
    function q() { var o = {}; var s = w.location.search; if (!s) return o; s = s.substring(1); var a = s.split("&"); for (var i = 0; i < a.length; i++) { var kv = a[i].split("="); o[decodeURIComponent(kv[0])] = decodeURIComponent(kv[1] || ""); } return o; }
    function fmt(n) { return (Number(n)).toFixed(4); }
    function post(id) { var h = d.documentElement.scrollHeight; if (w.parent && w.parent.postMessage) w.parent.postMessage({ type: "EURPLN_WIDGET_HEIGHT", instanceId: id, height: h }, "*"); }
    var p = q(); var id = p.instanceId || "x"; var r = d.getElementById("r"); var s = d.getElementById("s"); var ts = d.getElementById("ts");
    function tick() {
        s.textContent = "Aktualizacja…";
        var x = new XMLHttpRequest();
        x.open("GET", "https://api.nbp.pl/api/exchangerates/rates/A/EUR/?format=json&_=" + Date.now(), true);
        x.onreadystatechange = function () {
            if (x.readyState !== 4) return;
            try {
                var m = JSON.parse(x.responseText).rates[0].mid;
                r.textContent = fmt(m);
                s.textContent = "OK";
            } catch (e) { s.textContent = "Błąd"; }
            ts.textContent = new Date().toLocaleTimeString();
            post(id);
        };
        x.send();
    }
    tick();
    setInterval(tick, 10000);
    setInterval(function () { post(id); }, 1000);
})(window, document);
